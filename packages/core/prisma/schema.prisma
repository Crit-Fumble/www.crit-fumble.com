generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL")
}

model Account {
  id                       String  @id
  userId                   String
  type                     String
  provider                 String
  providerAccountId        String
  refresh_token            String?
  refresh_token_expires_in Int?
  access_token             String?
  expires_at               Int?
  token_type               String?
  scope                    String?
  id_token                 String?
  session_state            String?
  oauth_token_secret       String?
  oauth_token              String?
  User                     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Example {
  id            Int     @id @default(autoincrement())
  name          String?
  description   String?
  domainCount   Int?
  url           String?
  image         String?
  imageBlurhash String?
}

model Post {
  id            String   @id
  title         String?
  description   String?
  content       String?
  slug          String   @unique
  image         String?  @default("https://public.blob.vercel-storage.com/eEZHAoPTOBSYGBE3/hxfcV5V-eInX3jbVUhjAt1suB7zB88uGd1j20b.png")
  imageBlurhash String?  @default("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAhCAYAAACbffiEAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR4nN3XyZLDIAwE0Pz/v3q3r55JDlSBplsIEI49h76k4opexCK/juP4eXjOT149f2Tf9ySPgcjCc7kdpBTgDPKByKK2bTPFEdMO0RDrusJ0wLRBGCIuelmWJAjkgPGDSIQEMBDCfA2CEPM80+Qwl0JkNxBimiaYGOTUlXYI60YoehzHJDEm7kxjV3whOQTD3AaCuhGKHoYhyb+CBMwjIAFz647kTqyapdV4enGINuDJMSScPmijSwjCaHeLcT77C7EC0C1ugaCTi2HYfAZANgj6Z9A8xY5eiYghDMNQBJNCWhASot0jGsSCUiHWZcSGQjaWWCDaGMOWnsCcn2QhVkRuxqqNxMSdUSElCDbp1hbNOsa6Ugxh7xXauF4DyM1m5BLtCylBXgaxvPXVwEoOBjeIFVODtW74oj1yBQah3E8tyz3SkpolKS9Geo9YMD1QJR1Go4oJkgO1pgbNZq0AOUPChyjvh7vlXaQa+X1UXwKxgHokB2XPxbX+AnijwIU4ahazAAAAAElFTkSuQmCC")
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  published     Boolean  @default(false)
  siteId        String?
  userId        String?
  Site          Site?    @relation(fields: [siteId], references: [id], onDelete: Cascade)
  User          User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([slug, siteId])
  @@index([siteId])
  @@index([userId])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Site {
  id            String   @id
  name          String?
  description   String?
  logo          String?  @default("https://public.blob.vercel-storage.com/eEZHAoPTOBSYGBE3/JRajRyC-PhBHEinQkupt02jqfKacBVHLWJq7Iy.png")
  font          String   @default("font-cal")
  image         String?  @default("https://public.blob.vercel-storage.com/eEZHAoPTOBSYGBE3/hxfcV5V-eInX3jbVUhjAt1suB7zB88uGd1j20b.png")
  imageBlurhash String?  @default("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAhCAYAAACbffiEAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR4nN3XyZLDIAwE0Pz/v3q3r55JDlSBplsIEI49h76k4opexCK/juP4eXjOT149f2Tf9ySPgcjCc7kdpBTgDPKByKK2bTPFEdMO0RDrusJ0wLRBGCIuelmWJAjkgPGDSIQEMBDCfA2CEPM80+Qwl0JkNxBimiaYGOTUlXYI60YoehzHJDEm7kxjV3whOQTD3AaCuhGKHoYhyb+CBMwjIAFz647kTqyapdV4enGINuDJMSScPmijSwjCaHeLcT77C7EC0C1ugaCTi2HYfAZANgj6Z9A8xY5eiYghDMNQBJNCWhASot0jGsSCUiHWZcSGQjaWWCDaGMOWnsCcn2QhVkRuxqqNxMSdUSElCDbp1hbNOsa6Ugxh7xXauF4DyM1m5BLtCylBXgaxvPXVwEoOBjeIFVODtW74oj1yBQah3E8tyz3SkpolKS9Geo9YMD1QJR1Go4oJkgO1pgbNZq0AOUPChyjvh7vlXaQa+X1UXwKxgHokB2XPxbX+AnijwIU4ahazAAAAAElFTkSuQmCC")
  subdomain     String?  @unique
  customDomain  String?  @unique
  message404    String?  @default("Blimey! You've found a page that doesn't exist.")
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  userId        String?
  Post          Post[]
  User          User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model User {
  id            String         @id
  discord_id    String? // Discord User ID
  worldanvil_id String? // World Anvil User ID
  name          String?
  slug          String?        @unique
  email         String?        @unique
  emailVerified DateTime?
  image         String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @default(now())
  admin         Boolean?       @default(false)
  data          Json?
  Account       Account[]
  Post          Post[]
  Session       Session[]
  Site          Site[]
  RpgCharacter  RpgCharacter[]
}

// Deprecated tables removed: UserDiscord, UserDndBeyond, UserRoll20, UserWorldAnvil
// External service data now comes from service APIs instead of database tables

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model RpgSystem {
  id                   String   @id @default(cuid())
  worldanvil_system_id String?  @unique
  discord_post_id      String?  @unique // Discord Forum Post Id
  discord_chat_id      String?  @unique // Discord Chat Channel Id
  discord_thread_id    String?  @unique // Discord Chat Thread Id
  discord_forum_id     String?  @unique // Discord Forum Channel Id
  discord_voice_id     String?  @unique // Discord Voice Channel Id
  discord_role_id      String?  @unique // Discord Role Id
  title                String
  slug                 String?  @unique
  description          String?
  data                 Json?
  is_active            Boolean  @default(true)
  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt

  // Relations
  rpg_campaigns RpgCampaign[]
  rpg_sheets    RpgSheet[]
  rpg_worlds    RpgWorld[]

  @@map("RpgSystem")
}

model RpgWorld {
  id                  String   @id @default(cuid())
  worldanvil_world_id String?  @unique
  discord_post_id     String?  @unique // Discord Forum Post Id
  discord_chat_id     String?  @unique // Discord Chat Channel Id
  discord_thread_id   String?  @unique // Discord Chat Thread Id
  discord_forum_id    String?  @unique // Discord Forum Channel Id
  discord_voice_id    String?  @unique // Discord Voice Channel Id
  discord_role_id     String?  @unique // Discord Role Id
  rpg_system_id       String?
  gm_ids              String[]
  title               String
  slug                String?  @unique
  summary             String?
  description         String?  @db.Text
  is_active           Boolean  @default(true)
  data                Json?
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  // Relations
  rpg_system    RpgSystem?    @relation(fields: [rpg_system_id], references: [id])
  rpg_campaigns RpgCampaign[]
  rpg_sheets    RpgSheet[]

  @@map("RpgWorld")
}

model RpgCampaign {
  id                     String   @id @default(cuid())
  worldanvil_campaign_id String? // World Anvil Campaign Id
  discord_post_id        String?  @unique // Discord Forum Post Id
  discord_chat_id        String?  @unique // Discord Chat Channel Id
  discord_thread_id      String?  @unique // Discord Chat Thread Id
  discord_forum_id       String?  @unique // Discord Forum Channel Id
  discord_voice_id       String?  @unique // Discord Voice Channel Id
  discord_role_id        String?  @unique // Discord Role Id
  title                  String
  slug                   String?  @unique
  description            String?
  gm_ids                 String[] // User/Account IDs for GMs
  is_active              Boolean  @default(true)
  data                   Json? // System-specific data
  created_at             DateTime @default(now())
  updated_at             DateTime @updatedAt

  // Relations
  rpg_system_id String?
  rpg_system    RpgSystem? @relation(fields: [rpg_system_id], references: [id])
  rpg_world_id  String?
  rpg_world     RpgWorld?  @relation(fields: [rpg_world_id], references: [id])
  rpg_parties   RpgParty[]
  rpg_sheets    RpgSheet[] // All sheets associated with this campaign

  @@map("Campaign")
}

model RpgParty {
  id                  String       @id
  worldanvil_party_id String?      @unique
  discord_post_id     String?      @unique // Discord Forum Post Id
  discord_chat_id     String?      @unique // Discord Chat Channel Id
  discord_thread_id   String?      @unique // Discord Chat Thread Id
  discord_forum_id    String?      @unique // Discord Forum Channel Id
  discord_voice_id    String?      @unique // Discord Voice Channel Id
  discord_role_id     String?      @unique // Discord Role Id
  rpg_campaign_id     String
  slug                String?      @unique
  title               String
  description         String?
  is_active           Boolean      @default(true)
  data                Json?
  rpg_campaign        RpgCampaign? @relation(fields: [rpg_campaign_id], references: [id])
  rpg_sheets          RpgSheet[]
  rpg_sessions        RpgSession[]

  @@map("RpgParty")
}

model RpgSession {
  id               String   @id(map: "RpgSession_pkey")
  worldanvil_id    String? // World Anvil Session ID
  discord_event_id String? // Discord Event ID
  title            String
  description      String?
  data             Json?
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  // Relations
  rpg_party_id String?
  rpg_party    RpgParty? @relation(fields: [rpg_party_id], references: [id])

  @@map("RpgSession")
}

model RpgCharacter {
  id                      String     @id
  discord_post_id         String?    @unique // Discord Forum Post Id
  discord_thread_id       String?    @unique // Discord Chat Thread Id
  worldanvil_character_id String? // World Anvil Character ID
  user_id                 String? // User ID
  name                    String?
  slug                    String?    @unique
  title                   String?
  summary                 String?
  description             String?    @db.Text
  portrait_url            String?
  token_url               String?
  is_active               Boolean    @default(true)
  created_at              DateTime   @default(now())
  updated_at              DateTime   @default(now())
  rpg_sheets              RpgSheet[]

  // Relations
  user User? @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("Character")
}

model RpgSheet {
  id                  String    @id @default(cuid())
  worldanvil_block_id String?   @unique // World Anvil Block ID
  discord_post_id     String?   @unique // Discord Forum Post Id
  discord_thread_id   String?   @unique // Discord Chat Thread Id
  title               String?
  slug                String?   @unique
  summary             String?
  description         String?   @db.Text
  portrait_url        String?
  token_url           String?
  data                Json?
  is_active           Boolean   @default(true)
  admin_only          Boolean   @default(false)
  last_played         DateTime?
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt

  // Relations
  rpg_character_id String?
  rpg_system_id    String?
  rpg_party_id     String?
  rpg_campaign_id  String?
  rpg_world_id     String?

  // Sheet can optionally belong to a character
  rpg_character RpgCharacter? @relation(fields: [rpg_character_id], references: [id], onDelete: SetNull)
  // Sheet can optionally belong to a system
  rpg_system    RpgSystem?    @relation(fields: [rpg_system_id], references: [id], onDelete: SetNull)
  // Sheet can optionally belong to a party
  rpg_party     RpgParty?     @relation(fields: [rpg_party_id], references: [id], onDelete: SetNull)
  // Sheet can optionally belong to a campaign
  rpg_campaign  RpgCampaign?  @relation(fields: [rpg_campaign_id], references: [id], onDelete: SetNull)
  // Sheet can optionally belong to a world
  rpg_world     RpgWorld?     @relation(fields: [rpg_world_id], references: [id], onDelete: SetNull)

  @@index([rpg_character_id], map: "RpgSheet_character_id_idx")
  @@index([rpg_system_id], map: "RpgSheet_rpg_system_id_idx")
  @@index([is_active], map: "RpgSheet_is_active_idx")
  @@map("RpgSheet")
}
